---
steps:
  - label: "do not panic :cherry_blossom::whale:"
    command: "echo hello, engineer"
    agents:
      queue: fma-dev

  - wait

  - label: ":docker: Building Test Image and Pushing to Cloudsmith"
    command: ops/scripts/build-and-push.sh
    # branches: "main"
    env:
      ENVIRONMENT: "test"
    agents:
      queue: fma-dev

  - wait

  - label: ":k8s: Deploy to test"
    command: ops/scripts/deploy.sh
    # branches: main
    env:
      ENVIRONMENT: "test"
    agents:
      queue: "europa-preprod-fma"

  - block: "Deploy to production"
    branches: "main"

  - wait

  - label: ":docker: Building Production Image and Pushing to Cloudsmith"
    command: ops/scripts/build-and-push.sh
    branches: "main"
    env:
      ENVIRONMENT: "production"
    agents:
      queue: fma-dev

  - wait

  - label: ":partyparrot: Deploy to production"
    command: ops/scripts/deploy.sh
    branches: main
    env:
      ENVIRONMENT: "production"
    agents:
      queue: "europa-preprod-fma"
